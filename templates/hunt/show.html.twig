{% extends 'base.html.twig' %}

{% block title %}
	{{ job.intitule }}
{% endblock %}

{% block body %}
	{% block stylesheets %}
		{{ parent() }}
		<link rel="stylesheet" href="{{ asset('styles/show.css') }}">
	{% endblock %}

	<div class="job-container">
		<a href="{{ path('app_hunt') }}" class="back-link">â† Retour Ã  la recherche</a>

		{% for message in app.flashes('success') %}
			<div style="background:#dcfce7; color:#166534; padding:1rem; border-radius:8px; margin-bottom: 2rem; border: 1px solid #bbf7d0;">
            âœ… {{ message }}
			</div>
		{% endfor %}
		{% for message in app.flashes('error') %}
			<div style="background:#fee2e2; color:#991b1b; padding:1rem; border-radius:8px; margin-bottom: 2rem; border: 1px solid #fecaca;">
            âŒ {{ message }}
			</div>
		{% endfor %}

		<div class="header-box">
			<h1 class="job-h1">{{ job.intitule }}</h1>
        <div class="company">ğŸ¢ {{ job.entreprise.nom ?? 'Entreprise Confidentielle' }}</div>

			<div class="badges">
            <span class="badge">ğŸ“ {{ job.lieuTravail.libelle }}</span>
            <span class="badge">ğŸ“œ {{ job.typeContrat }}</span>
            <span class="badge">â±ï¸ {{ job.dureeTravailLibelleConverti ?? job.dureeTravailLibelle ?? 'DurÃ©e non prÃ©cisÃ©e' }}</span>
            <span class="badge">ğŸ“… PubliÃ© le {{ job.dateCreation | date('d/m/Y') }}</span>
				{% if job.salaire.libelle is defined %}
                <span class="badge badge-money">ğŸ’° {{ job.salaire.libelle }}</span>
				{% endif %}
			</div>
		</div>

		<div class="content-box">
			<h3 class="section-title">Description du poste</h3>
			<div class="description">{{ job.description }}</div>
		</div>

		<div class="content-box">
			<h3 class="section-title">Profil recherchÃ©</h3>

			{% if job.experienceLibelle is defined %}
            <p><strong>ğŸ“ ExpÃ©rience :</strong> {{ job.experienceLibelle }}</p>
			{% endif %}

			{% if job.formation is defined and job.formation is not empty %}
             <p><strong>ğŸ“š Formation :</strong> {{ job.formation[0].domaineLibelle ?? job.formation[0].niveauLibelle }}</p>
			{% endif %}

			{% if job.competences is defined %}
				<div style="margin-top: 1.5rem;">
					<strong>ğŸ›  CompÃ©tences :</strong>
					<div class="skills-grid">
						{% for comp in job.competences %}
							<span class="skill-tag">{{ comp.libelle }}</span>
						{% endfor %}
					</div>
				</div>
			{% endif %}
		</div>

		{% if job.contact is defined %}
			<div class="content-box">
				<h3 class="section-title">Contact</h3>
				{% if job.contact.nom is defined %}
					<p>ğŸ‘¤
						{{ job.contact.nom }}</p>
				{% endif %}
				{% if job.contact.courriel is defined %}
					<p>ğŸ“§
						{{ job.contact.courriel }}</p>
				{% endif %}
				<p style="font-size: 0.9rem; color: #64748b;">{{ job.contact.coordonnees1 ?? '' }}</p>
			</div>
		{% endif %}

		{# --- C'EST ICI QU'ON AJOUTE LE BLOC LETTRE --- #}
		{% if generatedLetter is defined and generatedLetter %}
			<div class="content-box" style="border: 2px solid #6366f1; background: #fdfcff;">
				<h3 class="section-title" style="color: #4f46e5;">âœ¨ Lettre de motivation gÃ©nÃ©rÃ©e</h3>

				<div id="letter-content" style="background: white; padding: 1.5rem; border-radius: 8px; border: 1px solid #e0e7ff; font-family: 'Courier New', Courier, monospace; font-size: 0.95rem; line-height: 1.6; white-space: pre-line;">
					{{ generatedLetter }}
				</div>

				<div style="margin-top: 1rem; text-align: right;">
                <button onclick="navigator.clipboard.writeText(document.getElementById('letter-content').innerText); alert('Texte copiÃ© dans le presse-papier ! ğŸ“‹')" 
                        style="cursor: pointer; color: #4f46e5; background: none; border: none; font-weight: 600; display: inline-flex; align-items: center; gap: 5px;">
						ğŸ“‹ Copier le texte
					</button>
				</div>
			</div>
		{% endif %}
		{# --------------------------------------------- #}

		<div class="action-bar">
			<div style="font-size: 0.9rem; color: #64748b; font-weight: 500;">
				Cette offre vous plaÃ®t ?
			</div>
        <div style="display: flex; gap: 1rem; align-items: center;">

				{# BOUTON IA #}
				<a href="{{ path('app_job_generate_ai', {id: job.id}) }}" class="btn-ai" style="padding: 0.75rem 1.5rem; border-radius: 8px; text-decoration: none; font-weight: 600; display: inline-flex; align-items: center; gap: 0.5rem;">
					âœ¨ GÃ©nÃ©rer Lettre
				</a>

				{# BOUTON POSTULER #}
				{% set jobLink = job.origineOffre.urlOrigine ?? job.contact.urlPostulation ?? null %}
				{% if jobLink is null %}
					{% if job.id|length <= 8 %}
						{% set jobLink = 'https://candidat.francetravail.fr/offres/recherche/detail/' ~ job.id %}
					{% else %}
						{% set jobLink = 'https://candidat.francetravail.fr/offres/recherche' %}
					{% endif %}
				{% endif %}

				<a href="{{ jobLink }}" target="_blank" class="btn-apply">
					Postuler ğŸš€
				</a>
			</div>
		</div>

	</div>
{% endblock %}
